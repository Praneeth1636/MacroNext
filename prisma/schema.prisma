generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
}

enum Goal {
  CUT
  MAINTAIN
  BULK
}

enum DietType {
  VEG
  NONVEG
  VEGAN
  KETO
  HALAL
}

enum DeliveryWindow {
  MORNING
  AFTERNOON
  EVENING
}

enum Preference {
  LOW_CARB
  BALANCED
  HIGH_CARB
}

enum OrderStatus {
  PLACED
  PREPPING
  OUT_FOR_DELIVERY
  DELIVERED
}

model User {
  id            String    @id @default(cuid())
  clerkId       String?   @unique @map("clerk_id")
  name          String?
  email         String?   @unique
  role          Role      @default(USER)
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  profile       Profile?
  macroPlans    MacroPlan[]
  orders        Order[]
}

model Profile {
  id              String         @id @default(cuid())
  userId          String         @unique @map("user_id")
  user            User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  goal            Goal
  dietType        DietType       @map("diet_type")
  allergies       String[]       @default([])
  addressLine1    String         @map("address_line1")
  city            String
  state           String
  zip             String
  deliveryWindow  DeliveryWindow @map("delivery_window")
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")
}

model MacroPlan {
  id          String     @id @default(cuid())
  userId      String     @map("user_id")
  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  date        DateTime   @db.Date
  calories    Int
  protein     Int
  preference  Preference
  mealsCount  Int        @map("meals_count")
  notes       String?
  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")
  @@unique([userId, date])
}

model Order {
  id             String      @id @default(cuid())
  userId         String      @map("user_id")
  user           User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  date           DateTime    @db.Date
  status         OrderStatus @default(PLACED)
  totalCalories  Int         @map("total_calories")
  totalProtein   Int         @map("total_protein")
  totalCarbs     Int?        @map("total_carbs")
  totalFat       Int?        @map("total_fat")
  generatedMeals Json       @map("generated_meals")
  createdAt      DateTime    @default(now()) @map("created_at")
  updatedAt      DateTime    @updatedAt @map("updated_at")
}

model MealCatalog {
  id       String   @id @default(cuid())
  name     String
  tags     String[] @default([])
  calories Int
  protein  Int
  carbs    Int
  fat      Int
}
